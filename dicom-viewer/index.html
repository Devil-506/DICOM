<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical DICOM Viewer - Advanced Imaging</title>
    <link rel="stylesheet" href="styles/main.css">
    <!-- Cornerstone DICOM Libraries -->
    <script src="https://unpkg.com/cornerstone-core"></script>
    <script src="https://unpkg.com/cornerstone-web-image-loader"></script>
    <script src="https://unpkg.com/cornerstone-wado-image-loader"></script>
    <script src="https://unpkg.com/dicom-parser"></script>
    <script src="https://unpkg.com/hammerjs"></script>
    <script src="https://unpkg.com/cornerstone-tools"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <h1>üè• Advanced DICOM Medical Viewer</h1>
        <div class="header-controls">
            <button id="loadFolder" class="btn-primary">üìÅ Load DICOM Folder</button>
            <input type="file" id="fileInput" multiple accept=".dcm,.dicom" style="display: none;">
            <span id="patientInfo" class="patient-info"></span>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="container">
        <!-- Sidebar - Series Navigation -->
        <aside class="sidebar">
            <div class="series-list" id="seriesList">
                <h3>üìÇ DICOM Series</h3>
                <div class="series-items" id="seriesItems">
                    <p class="empty-message">No DICOM files loaded</p>
                </div>
            </div>

            <div class="thumbnail-view" id="thumbnailView">
                <h3>üñºÔ∏è Series Preview</h3>
                <div class="thumbnails" id="thumbnails"></div>
            </div>
        </aside>

        <!-- Main Viewer Area -->
        <main class="main-viewer">
            <!-- Toolbar -->
            <div class="toolbar">
                <div class="tool-group">
                    <button id="zoomIn" class="tool-btn" title="Zoom In">üîç+</button>
                    <button id="zoomOut" class="tool-btn" title="Zoom Out">üîç-</button>
                    <button id="pan" class="tool-btn active" title="Pan">‚úã</button>
                    <button id="wwwl" class="tool-btn" title="Window/Level">‚ö°</button>
                    <button id="reset" class="tool-btn" title="Reset View">üîÑ</button>
                </div>
                
                <div class="tool-group">
                    <button id="playPause" class="tool-btn" title="Play Series">‚ñ∂Ô∏è</button>
                    <span id="frameInfo" class="frame-info">Frame: 0/0</span>
                    <input type="range" id="sliceSlider" min="0" max="0" value="0" class="slice-slider">
                </div>

                <div class="tool-group">
                    <button id="measureLength" class="tool-btn" title="Measure Length">üìè</button>
                    <button id="measureAngle" class="tool-btn" title="Measure Angle">üìê</button>
                    <button id="annotate" class="tool-btn" title="Annotate">üñäÔ∏è</button>
                    <button id="crop" class="tool-btn" title="Crop">‚úÇÔ∏è</button>
                </div>
            </div>

            <!-- Image Display Area -->
            <div class="viewer-container">
                <div id="dicomViewer" class="dicom-viewer"></div>
                <div class="overlay-info">
                    <div id="imageInfo" class="image-info"></div>
                    <div id="measurements" class="measurements"></div>
                </div>
            </div>

            <!-- Window/Level Controls -->
            <div class="wl-controls">
                <label>Window: <span id="windowValue">1000</span></label>
                <input type="range" id="windowSlider" min="1" max="4000" value="1000" class="wl-slider">
                <label>Level: <span id="levelValue">500</span></label>
                <input type="range" id="levelSlider" min="-1000" max="3000" value="500" class="wl-slider">
            </div>
        </main>

        <!-- Metadata Panel -->
        <aside class="metadata-panel">
            <div class="panel-header">
                <h3>üìä DICOM Metadata</h3>
                <button id="toggleMetadata" class="toggle-btn">‚ñº</button>
            </div>
            
            <div class="metadata-content" id="metadataContent">
                <!-- Patient Information -->
                <div class="metadata-section">
                    <h4>üë§ Patient Information</h4>
                    <div class="metadata-grid" id="patientMetadata"></div>
                </div>

                <!-- Study Information -->
                <div class="metadata-section">
                    <h4>üìã Study Information</h4>
                    <div class="metadata-grid" id="studyMetadata"></div>
                </div>

                <!-- Series Information -->
                <div class="metadata-section">
                    <h4>üñºÔ∏è Series Information</h4>
                    <div class="metadata-grid" id="seriesMetadata"></div>
                </div>

                <!-- Acquisition Parameters -->
                <div class="metadata-section">
                    <h4>‚öôÔ∏è Acquisition Parameters</h4>
                    <div class="metadata-grid" id="acquisitionMetadata"></div>
                </div>

                <!-- Image Parameters -->
                <div class="metadata-section">
                    <h4>üñºÔ∏è Image Parameters</h4>
                    <div class="metadata-grid" id="imageMetadata"></div>
                </div>
            </div>
        </aside>
    </div>

    <!-- Modals -->
    <div id="loadingModal" class="modal">
        <div class="modal-content">
            <h3>Loading DICOM Files...</h3>
            <div class="progress-bar">
                <div class="progress" id="loadProgress"></div>
            </div>
            <p id="loadStatus">Initializing...</p>
        </div>
    </div>

    <script src="js/dicom-loader.js"></script>
    <script src="js/image-viewer.js"></script>
    <script src="js/metadata-panel.js"></script>
    <script src="js/tools.js"></script>
    <script src="js/app.js"></script>
</body>
</html>